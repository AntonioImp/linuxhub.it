---
title: '#howto - Impostare gli header di sicurezza su Apache2 e Nginx'
published: 2019-09-23
layout: post
author: Alessandro Zangrandi
author_github: AlexzanDev
tags:
  - nginx  - apache
---
<p>Possedete uno o più siti web, avete intero accesso al server e volete potenziare la loro sicurezza? Potete farlo con gli <strong>header di sicurezza</strong>.</p><h2>Cosa sono gli header di sicurezza?</h2><p>Gli header di sicurezza sono degli <strong>header HTTP</strong> ricevuti in risposta dal browser utilizzati per <strong>migliorare la protezione</strong> di un'applicazione web. Una volta impostati, questi header limitano i browser moderni dal cadere facilmente in alcune vulnerabilità conosciute e prevenibili.</p><h2>È facile impostare gli header di sicurezza?</h2><p>Assolutamente sì. Infatti, è solamente necessario possedere l'accesso alle configurazioni di Apache2 o Nginx dei propri siti web, e dopo aver inserito delle piccole, ma utili stringhe di testo, il gioco sarà fatto.</p><h2>Principali header di sicurezza</h2><p>Vediamo assieme una lista dei principali header di sicurezza, altamente consigliati da impostare:</p><ul>	<li><strong>HTTP Strict Transport Security (HSTS)</strong></li>	<li><strong>X-Frame-Options</strong></li>	<li><strong>X-XSS-Protection</strong></li>	<li><strong>X-Content-Type-Options</strong></li>	<li><strong>Content-Security-Policy</strong></li>	<li><strong>Referrer-Policy</strong></li></ul><h2>HTTP Strict Transport Security (HSTS)</h2><p>L'HTTP Strict Transport Security, abbreviato in HSTS, è un meccanismo della policy della sicurezza web che aiuta a proteggere i siti web contro gli attacchi downgrade e l'hijacking dei cookie. L'HSTS indica ai web server che le connessioni con i browser (o user agent) devono essere effettuate <strong>solamente in HTTPS</strong>, e mai attraverso l'insicuro protocollo HTTP. La policy può essere impostata inserendo nella propria configurazione l'header Strict-Transport-Security, e deve essere utilizzato solo se desiderate che le connessioni al vostro sito web arrivino esclusivamente in HTTPS.</p><p>Un esempio di configurazione di questo header è il seguente:</p><pre><code>Strict-Transport-Security: max-age=31536000 ; includeSubDomains</code></pre><p>Il parametro <em>max-age</em> serve per indicare il tempo in cui il browser si deve ricordare che l'accesso al sito internet deve essere effettuato solo via HTTPS. <em>includeSubDomains</em>, invece, è un parametro opzionale, e può essere inserito per indicare che l'HSTS deve essere applicato anche ai sottodomini, nel caso ne aveste qualcuno.</p><h2>X-Frame-Options</h2><p>L'header di risposta <strong>X-Frame-Options</strong> serve a proteggere le applicazioni web dal fenomeno chiamato Clickjacking. Esso indica al browser che non deve in alcun modo mostrare i contenuti trasmessi in frame di altre pagine web.</p><p>Un esempio di configurazione di X-Frame-Options è il seguente:</p><pre><code>X-Frame-Options: deny</code></pre><p>Il valore deny vieta in tutti i modi che un frame mostri i contenuti di altre pagine web. A questo header possono essere impostati più valori:</p><ul>	<li>deny</li>	<li>sameOrigin</li>	<li>allow-from: Dominio</li></ul><p>Il primo. <em>deny</em>, è già stato spiegato. Impostando, invece, <em>sameOrigin</em>, si obbliga il browser a bloccare quanto impostato in un frame solamente se l'origine dei contenuti non è la stessa del sito web che si sta visitando. <em>allow-from: Dominio</em> permette che il frame mostri dei contenuti solamente se provenienti da un dominio specificato.</p><h2>X-XSS-Protection</h2><p>L'header <strong>X-XSS-Protection</strong> imposta delle regole per il filtro che protegge il browser dal Cross-Site Scripting, noto appunto come XSS.</p><p>Vediamo un esempio di impostazione dell'X-XSS-Protection:</p><pre><code>X-XSS-Protection: 1; mode=block</code></pre><p>Ecco tutti i valori impostabili all'header:</p><ul>	<li><em>0</em>, disabilita il filtro</li>	<li><em>1</em>, abilita il filtro, e quando si rileva un attacco XSS la pagina viene pulita</li>	<li><em>1; mode=block</em>, abilita il filtro, e in caso di attacco XSS la pagina non viene pulita, bensì il suo caricamento è proprio bloccato</li>	<li><em>1; report=http://[tuodominio]/URI_tua_segnalazione</em>, abilita il filtro, ed in caso di attacco XSS la pagina viene pulita e la violazione viene registrata su una pagina a tua scelta. Si tratta di una funzione di Chromium</li></ul><h2>X-Content-Type-Options</h2><p>Quando l'header <strong>X-Content-Type-Options</strong> viene impostato, si previene che il browser interpreti un file in modo diverso rispetto a quanto indicato dagli header HTTP con i tipi MIME.</p><p>Esempio di impostazione dell'X-Content-Type-Options:</p><pre><code>X-Content-Type-Options: nosniff</code></pre><p>Solamente il valore <em>nosniff </em>è utilizzabile, siccome non ne esistono altri. Il suo scopo è quello di evitare che il browser legga una risposta di un tipo MIME diverso rispetto a quanto indicato.</p><h2>Content-Security-Policy</h2><p>L'header<strong> Content-Security-Policy</strong>, o CSP, è uno dei più difficili da impostare, e richiede un'approfondita conoscenza di quello che è presente nelle pagine web dei propri siti. Se abilitato, il CSP ha un impatto significativo sul come il browser carica una pagina: con questo header infatti possono essere scelti gli script JavaScript da non caricare, così come per i file di stile. Proprio per questo motivo il CSP aiuta a prevenire vari tipi di attacchi, tra cui il Cross-site scripting ed altre injection cross-site.</p><p>Un esempio di impostazione del CSP è il seguente:</p><pre><code>Content-Security-Policy: script-src 'self'</code></pre><p>Così impostato, il server indica al browser che solamente gli script JavaScript provenienti dallo stesso dominio possono essere eseguiti, mentre gli altri devono essere bloccati.</p><p>Ecco tutti i parametri impostabili nella CSP:</p><ul>	<li><em>base-uri</em></li>	<li><em>default-src</em></li>	<li><em>script-src</em></li>	<li><em>object-src</em></li>	<li><em>style-src</em></li>	<li><em>img-src</em></li>	<li><em>media-src</em></li>	<li><em>frame-src</em></li>	<li><em>child-src</em></li>	<li><em>frame-ancestors</em></li>	<li><em>font-src</em></li>	<li><em>connect-src</em></li>	<li><em>manifest-src</em></li>	<li><em>form-action</em></li>	<li><em>sandbox</em></li>	<li><em>script-nonce</em></li>	<li><em>plugin-types</em></li>	<li><em>reflected-xss</em></li>	<li><em>block-all-mixed-content</em></li>	<li><em>upgrade-insecure-requests</em></li>	<li><em>referrer</em></li>	<li><em>report-uri</em></li>	<li><em>report-to</em></li></ul><p>Se vengono impostati più valori, ricordatevi di separarli con un punto e virgola come nell'esempio qui sotto:</p><pre><code>Content-Security-Policy: script-src https://linuxhub.it/script.js https://google.it/scriptest123.js; style-src 'self'</code></pre><p>Esatto, si possono anche impostare dei link o file multipli.</p><h2>Referrer Policy</h2><p>L'header <strong>Referrer Policy</strong> definisce quante informazioni riguardanti il server o l'applicazione web devono essere mandati in risposta al browser.</p><p>Un esempio di impostazione della Referrer Policy:</p><pre><code>Referrer-Policy: no-referrer-when-downgrade</code></pre><p>Ecco tutti i parametri impostabili per questo header di sicurezza:</p><ul>	<li><em>no-referrer</em>, l'header Referrer viene completamente omesso</li>	<li><em>no-referrer-when-downgrade</em>, l'header Referrer viene mostrato se una risorsa viene caricata sullo stesso protocollo (in questo caso HTTPS), e si omette se si passa da quest'ultimo all'HTTP.</li>	<li><em>origin</em>, indica solamente l'origine del documento</li>	<li><em>origin-when-cross-domain</em>, manda un intero URL quando viene effettuata una richiesta su uno stesso dominio, mentre fa sapere esclusivamente l'origine del documento in altri casi</li>	<li><em>same-origin</em>, un Referrer viene inviato solo se i documenti provengono dallo stesso sito, mentre le richieste cross-origin non mostreranno nessun'informazione</li>	<li><em>strict-origin</em>, simile al secondo parametro, indica l'origine del documento invece dell'header</li>	<li><em>strict-origin-when-cross-origin</em>, invia l'origine del documento tramite un URL intero solo se la richiesta viene effettuata da HTTPS a HTTPS</li>	<li><em>unsafe-url</em>, fornisce un intero URL quando si effettua una richiesta dalla stessa o più origini</li></ul><h2>Come inserire gli header di sicurezza in Apache2</h2><p>Per prima cosa, apriamo il nostro file apache2.conf su Debian e derivate, o httpd.conf su CentOS e RHEL-based (la locazione della configurazione potrebbe variare, e qui sotto ho inserito le directory principali, pertanto dovete solo capire dove si trova):</p><pre><code>sudo nano /etc/apache2/apache2.confsudo nano /etc/apache2/httpd.confsudo nano /etc/httpd/httpd.confsudo nano /etc/httpd/conf/httpd.conf</code></pre><p>e accertiamoci che la seguente riga non sia commentata:</p><pre><code>LoadModule headers_module modules/mod_headers.so</code></pre><p>Se non è abilitato, controlliamo che questo modulo sia caricato (non eseguito) da Apache con il seguente comando:</p><pre><code>apache2ctl -M</code></pre><p>Nel caso non fosse presente nella lista, abilitatelo con questo comando:</p><pre><code>a2enmod headers</code></pre><p>e riavviamo Apache:</p><pre><code>sudo apache2ctl restart</code></pre><p>Se il modulo è installato, alla fine del file potete inserire gli header di sicurezza che desiderate. Ecco un esempio basato sulla mia esperienza e preferenza:</p><pre><code>Header set X-XSS-Protection "1; mode=block"Header always append X-Frame-Options SAMEORIGINHeader set X-Content-Type-Options nosniffHeader always set Strict-Transport-Security "max-age=31536000; includeSubDomains"Header always set Referrer-Policy "no-referrer-when-downgrade"</code></pre><p>Se volete aggiungere un header che io non utilizzo e/o non è presente tra i consigliati, ricordatevi sempre di aggiungere davanti ad esso <em>Header set</em> o <em>Header always set</em> in base alle situazioni.</p><p>Controlliamo se è tutto impostato correttamente:</p><pre><code>sudo apache2ctl -t</code></pre><p>Ora possiamo riavviare Apache con:</p><pre><code>sudo apache2ctl restart</code></pre><h2>Come inserire gli header di sicurezza su Nginx</h2><p>Per poter inserire gli header di sicurezza su <strong>Nginx</strong>, il procedimento è quasi simile. Apriamo il nostro file di configurazione del web server:</p><pre><code>sudo nano /etc/nginx/nginx.conf</code></pre><p>E inseriamo i nostri header preferiti:</p><pre><code>add_header X-XSS-Protection "1; mode=block";add_header X-Frame-Options SAMEORIGIN;add_header X-Content-Type-Options nosniff;add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;add_header Referrer-Policy no-referrer-when-downgrade;</code></pre><p>Controlliamo di non aver effettuato errori nel file di configurazione:</p><pre><code>sudo nginx -t</code></pre><p>Se è tutto a posto, riavviamo Nginx:</p><pre><code>sudo service nginx restart</code></pre><h2>Conclusione</h2><p>Dopo aver inserito i nostri header di sicurezza, per verificare se un sito web è protetto possiamo visitare <a href="https://securityheaders.com">securityheaders.com</a> che ci dà una piccola panoramica di quello che viene rilevato.</p><img class=" size-full wp-image-542" alt="Panoramica degli header di sicurezza presenti su linuxhub.it" data-caption="Panoramica degli header di sicurezza presenti su linuxhub.it" data-entity-type="file" data-entity-uuid="d702163c-ead3-43ba-946f-a1b110adee8a" src="https://linuxhub.it/wordpress/wp-content/uploads/2019/09/security-headers-linuxhub.jpg" width="1581" height="600" /><p>Per dubbi e chiarimenti, fate accesso al nostro gruppo <a href="https://t.me/gentedilinux">Telegram</a>.</p>