---
title: '#howto – Nginx impostare la cache dei file statici su Centos 7'
published: 2019-06-14
layout: post
author: Mirko B.
author_github: mirkobrombin
tags:
  - nginx
---
<p>Una delle pratiche più conosciute per diminuire l'utilizzo di banda in un web server che ospita siti web statici ma anche dinamici, è di certo quello di sfruttare la cache, forzando quindi una scadenza differente per uno o più file nel browser dell'utente.</p><blockquote><p>Di norma i file che vengono contrassegnati con una scadenza maggiore, sono quelli statici (jpg, png, css, ..).</p><p>Ci sono poi file statici come HTML che non dovrebbero essere contrassegnati con una scadenza futura elevata, questo per evitare che l'utente non riceva più la versione aggiornata del file.</p></blockquote><h2>Configurazione della cache</h2><p>Possiamo creare una locazione dedicata ai file statici in ogni blocco server {...}, impostando una scadenza differente, in questo caso:</p><pre><code>location ~*  \.(jpg|jpeg|png|gif|ico|js|css)$ {   expires 365d;}</code></pre><p>informiamo il browser di impostare una scadenza di un anno per tutti i file di tipo: jpg, jpeg, png, gif, ico, js, css.</p><p>Una volta configurato il blocco, ricarichiamo la configurazione di nginx via systemctl:</p><pre><code>sudo systemctl reload nginx</code></pre><h2>Versionamento dei file CSS e JS</h2><p>I documenti di tipo CSS e JS, potrebbero essere visti come file non del tutto statici, in quanto lo stile e la funzione dinamica di un sito potrebbe essere rivisto spesso nel corso di un anno, è importante sottolineare che in questo caso bisogna sfruttare il versionamento dei file (file.css?v1, file.js?v1, ..) in modo da offrire sempre la versione aggiornata del foglio di stile nella cache del browser.</p><p>Nell'esempio in cui la versione dello stile <strong>style.css</strong> presente nella cache del browser è la seguente:</p><pre><code>body {    background-color: #242424;    color: cyan;    font-family: sans-serif;}</code></pre><p>e vogliamo riscriverla con la seguente:</p><pre><code>body {    background-color: #191919;    color: #fcfcfc;    font-family: "Roboto", sans-serif;    font-size: 13px;}</code></pre><p>ma la scadenza della cache è impostata a 365 giorni, possiamo semplicemente modificare il modo in cui includiamo il file, nel seguente metodo:</p><pre><code>&lt;link rel="stylesheet" type="text/css" href="style.css?v2" /&gt;</code></pre><p>in questo modo, alla prossima, il browser dell'utente scaricherà in cache la nuova versione del foglio di stile, con una validità di 365 giorni.</p><p>&nbsp;</p><p>Per dubbi e chiarimenti, utilizzate il nostro&nbsp;<a href="https://t.me/gentedilinux">gruppo Telegram</a>.</p><p><em>?Good *nix&nbsp;</em><strong><em>_Mirko</em></strong></p>