---
title: '#howto - Installare .Net Core su Debian'
published: 2019-05-15
layout: post
author: Hersel Giannella
author_github: hersel
tags:
  - nginx  - debian  - letsencrypt  - netcore
---
<p>In questa guida vediamo come installare e rendere funzionale .NET Core su server Debian.</p><h2>Introduzione</h2><p>.<strong>NET Core</strong> è un framework modulare gratuito e Open source sviluppato da Microsoft per sistemi operativi Windows, Linux e MacOS.</p><p>Formato da CoreCLR, un'implementazione runtime completa di CLR, la macchina virtuale che gestisce l'esecuzione di programmi .NET.</p><p>CoreCLR viene inoltre fornito con un compilatore just-in-time ottimizzato, chiamato RyuJIT.</p><h2>Installazione</h2><p>Procediamo quindi con l'installazione vera e propria. È necessaria una Shell con accesso root. In questa guida utilizzeremo la versione di .NET Core stabile, la 2.2 nel momento in cui scrivo.</p><h3>Installazione<strong> </strong>SDK</h3><p>Partiamo con l'installare il SDK ossia la strumentazione base, completa di template, toolchain e runtimes.</p><p>Prima di tutto aggiungiamo le repository ufficiali e le chiavi necessarie:</p><pre><code>wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; microsoft.asc.gpgsudo mv microsoft.asc.gpg /etc/apt/trusted.gpg.d/wget -q https://packages.microsoft.com/config/debian/9/prod.listsudo mv prod.list /etc/apt/sources.list.d/microsoft-prod.list</code></pre><p>Impostiamo poi i giusti permessi:</p><pre><code>sudo chown root:root /etc/apt/trusted.gpg.d/microsoft.asc.gpgsudo chown root:root /etc/apt/sources.list.d/microsoft-prod.list</code></pre><p>Ora che abbiamo aggiunto le chiavi e le repository, procediamo con la vera e propria installazione dell'SDK</p><pre><code>sudo apt updatesudo apt install apt-transport-https dotnet-sdk-2.2</code></pre><h3>Installazione .NET Core</h3><p>Se tutto è andato a buon fine procediamo con l'installazione del runtime.</p><pre><code>sudo apt updatesudo apt install aspnetcore-runtime-2.2</code></pre><blockquote><p>Una volta svolti i precedenti punti, consiglio un reboot affinchè sia tutto pienamente funzionale.</p></blockquote><h2>Creazione della prima WebApp base</h2><p>Creiamo una cartella nella directory /<strong>root</strong>/<strong>testapp</strong>&nbsp; denominata testapp (nel nostro esempio):</p><pre><code>sudo mkdir /root/testapp</code></pre><p>entriamo nella nuova locazione:</p><pre><code>cd /root/testapp</code></pre><p>e creiamo l'applicazione via&nbsp;<strong>dotnet</strong>:</p><pre><code>dotnet new webapp</code></pre><p>il risultato sarà simile a questo:</p><pre><code>root@hersy:~/testapp|?  dotnet new webappThe template "ASP.NET Core Web App" was created successfully.This template contains technologies from parties other than Microsoft, see https://aka.ms/aspnetcore-template-3pn-210 for details.Processing post-creation actions...Running 'dotnet restore' on /root/testapp/testapp.csproj...  Restore completed in 4.82 sec for /root/testapp/testapp.csproj.Restore succeeded.</code></pre><p>Infine con dotnet <strong>run</strong> avviamo l'applicazione appena creata:</p><pre><code>dotnet run</code></pre><p>A questo punto, se tutto è andato a buon fine, inizierà a funzionare restituendo come risultato localhost:5001 &amp; 5000.</p><p>Accedendo da browser a http://localhost:5001 dovremmo vedere la nostra prima applicazione in .NET Core, funzionare.</p><h2>Pubblicazione tramite proxy_pass di Nginx</h2><p>In questo extra della guida, andiamo a vedere come "distribuire" la nostra applicazione via Nginx e sfruttando un certificato SSL.</p><h3>Prerequisiti</h3><ul>	<li>Nginx</li>	<li>Certbot</li>	<li>.Net Core SDK+Runtime</li></ul><h3>Creazione applicazione</h3><p>Creiamo una directory chiamata aspnetapp (nel nostro esempio), in /var/www:</p><pre><code>sudo mkdir /var/www/aspnetapp</code></pre><p>ed spostiamoci al suo interno:</p><pre><code>cd /var/www/aspnetapp</code></pre><p>Come abbiamo visto precedentemente, creiamo una nuova applicazione .NET Core:</p><pre><code>dotnet new webapp</code></pre><blockquote><p>La cartella /www potrebbe avere una locazione differente nel vostro server, in base alla vostra configurazione.</p></blockquote><h3>proxy_pass</h3><p>Andiamo ora a sfruttare il proxy_pass per creare un Reverse Proxy dalla porta della nostra applicazione a quella corretta 80 o 443.</p><p>Portiamoci in locazione:</p><pre><code>cd /etc/nginx</code></pre><p>in sites-available create un file di configurazione chiamato dotnetpass.conf e copiate la seguente configurazione</p><pre><code>server {     listen 443 ssl;     listen [::]:443 ssl;     server_name   example.com www.example.com;         ssl_certificate /etc/letsencrypt/live/youraccount/fullchain.pem; # managed by Certbot   ssl_certificate_key /etc/letsencrypt/live/youraccount/privkey.pem; # managed by Certbot   include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot   ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot       location / {        proxy_pass         https://localhost:5001;        proxy_http_version 1.1;        proxy_set_header   Upgrade $http_upgrade;        proxy_set_header   Connection keep-alive;        proxy_set_header   Host $host;        proxy_cache_bypass $http_upgrade;        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_set_header   X-Forwarded-Proto $scheme;    }}server {    if ($host = www.example.com) {        return 301 https://$host$request_uri;    } # managed by Certbot    if ($host = example.com) {        return 301 https://$host$request_uri;    } # managed by Certbot        listen 80;     listen [::]:80;     server_name example.com www.example.com;    return 404; # managed by Certbot}</code></pre><p>Abilitiamo infine la configurazione creando un link alla cartella sites-enabled:</p><p>Modificate la stringa server_name con il vostro dominio a disposizione, esempio: dotnet.vostrodominio.com</p><p>Nella stringa ssl_certificate &amp; ssl_certificate:_key inserite la posizione dei vostri certificati CERTBOT</p><p>Abilitiamo infine la configurazione creando un link alla cartella sites-enabled:</p><pre><code>ln -s /etc/nginx/sites-availables/dotnetpass.conf /etc/nginx/sites-enabled/dotnetpass.conf</code></pre><p>A questo punto ricarichiamo le configurazioni di Nginx:</p><pre><code>sudo service nginx restart</code></pre><p>Se non restituisce errori è andato tutto a buon fine.</p><p>Proseguiamo con l'abilitazione del certificato SSL per il nostro dominio:</p><pre><code>certbot --nginx -d ilvostrodominio.com -d www.ilvostrodominio.com -d dotnet.vostrodominio.com -d www.dotnet.vostrodominio.com</code></pre><p>Avviamo finalmente la nostra applicazione:</p><pre><code>cd /var/www/aspnetappdotnet run</code></pre><p>che dovrebbe ora essere disponibile sul dominio da noi scelto.</p>